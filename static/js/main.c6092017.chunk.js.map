{"version":3,"sources":["game/loaders/modelLoader.ts","infrastructure/decorators/onPropertyChange.ts","game/worldEnviroment.ts","game/gameObjects/gameObjectWorldData.ts","game/gameObjects/moveableGameObject.ts","game/gameObjects/gameObject.ts","game/services/gameStateDataService.ts","game/gameWorld.ts","game/gameRenderer.ts","game/controls/cameraOrbitControls.ts","game/controls/cameraMapControls.ts","game/controls/worldInteractionControls.ts","game/controls/gameControls.ts","game/helpers/object3dHelper.ts","assets/icons/tower-icon.svg","game/index.ts","components/ui/icons/withSvgIcon.tsx","assets/icons/well-icon.svg","components/ui/icons/index.ts","containers/game/components/basicUI.tsx","containers/game/index.tsx","containers/home/index.tsx","containers/index.tsx","index.tsx"],"names":["ModelLoader","baseUrl","gltfLoader","dracoLoader","loadedModels","initialize","loadModels","models","completeCallback","loadCount","forEach","m","loadModel","loadedModel","name","onLoaded","length","gameModel","callback","load","path","gltf","object","scene","this","GLTFLoader","DRACOLoader","valuesCacheKey","Symbol","lastCallKey","defaultConfig","bulk","history","OnChange","props","config","propertyNames","normaliseProps","clazz","methodName","propertyName","originalDescriptor","Object","getOwnPropertyDescriptor","defineProperty","set","value","instance","ensureHiddenProps","updateValueCache","call","shouldCallTargetMethod","callTargetMethod","get","cache","currentValue","undefined","Array","isArray","propName","firstChange","previousValue","definedPropNames","keys","every","includes","p","valueMap","mapper","values","map","reduce","obj","WorldEnviromentDebugEnum","GameObjectWorldData","position","x","y","z","rotation","destination","isDirty","scale","castShadow","receiveShadow","selected","highlighted","MoveableGameObject","key","model","worldData","movementSpeed","destinationReached","getDistanceToMove","source","delta","newPostion","moveDistance","diff","Math","abs","renderedWorldData","time","updateData","move","textContainer","lastTextUpdate","selectedCircleMesh","circle","show","event","visible","material","color","setHex","updateDataBase","dest","prop","updateCallback","destProp","newValue","geometry","RingGeometry","MeshBasicMaterial","Mesh","PI","document","createElement","className","style","marginTop","textLabel","CSS2DObject","newGroup","Group","add","clone","userData","gameObjectKey","setScalar","newPosition","newRotation","innerHTML","toString","GameStateDataService","apiUri","wsUri","socket","messageHandlers","connectToWebsocket","userId","Promise","resolve","reject","fetch","method","mode","headers","Accept","body","JSON","stringify","user_id","then","r","json","url","WebSocket","onopen","onmessage","onMessageRecived","catch","createUnit","send","CreatUnit","setUnit","id","SetUnit","fetchInitialGameState","response","state","addMessageHandler","type","handler","notifyHandlers","message","filter","h","e","msg","parse","data","process","WorldEnviroment","debugOptions","ambientLight","AmbientLight","light","DirectionalLight","shadow","bias","mapSize","width","height","d","camera","left","right","top","bottom","far","groundTexture","TextureLoader","wrapS","RepeatWrapping","wrapT","repeat","anisotropy","encoding","sRGBEncoding","groundMaterial","MeshLambertMaterial","groundMesh","PlaneGeometry","background","Color","fog","Fog","initializeDebug","setDebug","debug","ShowSmallGrid","smallGrid","GridHelper","ShowMediumGrid","mediumGrid","linewidth","ShowLargeGrid","largeGrid","GameWorld","gameObjects","worldEnviroment","update","gm","addGameObject","gameObject","setGameObject","g","getSceneIntersection","raycaster","intersectObject","moveSelectedGameObjects","go","getGameObjectIntersection","intersects","intersectObjects","intersectedModel","intersection","getGameObjectRoot","hoverGameObject","selectGameObject","removeExsistingSelection","getGameObjectByKey","objects","parent","GameRenderer","container","renderer","labelRenderer","clock","stats","fps","lastRender","Date","now","updateTargets","setPixelRatio","window","devicePixelRatio","setSize","innerWidth","innerHeight","outputEncoding","shadowMap","enabled","domElement","addEventListener","handleWindowResize","appendChild","dom","aspect","updateProjectionMatrix","addUpdateTarget","updateTarget","start","requestAnimationFrame","renderLoop","lastRenderDiff","interval","getDelta","render","WebGLRenderer","antialias","Clock","CSS2DRenderer","Stats","changeEvent","startEvent","endEvent","CameraMapControls","screenSpacePanning","mouseButtons","LEFT","MOUSE","PAN","RIGHT","ROTATE","touches","ONE","TOUCH","TWO","DOLLY_ROTATE","target","minDistance","maxDistance","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","keyPanSpeed","autoRotate","autoRotateSpeed","target0","position0","zoom0","domElementKeyEvents","getPolarAngle","getAzimuthalAngle","listenToKeyEvents","saveState","reset","dispose","console","warn","Vector3","Infinity","UP","BOTTOM","MIDDLE","DOLLY","DOLLY_PAN","zoom","spherical","phi","theta","onKeyDown","scope","copy","dispatchEvent","STATE","NONE","offset","quat","Quaternion","setFromUnitVectors","up","quatInverse","invert","lastPosition","lastQuaternion","twoPI","sub","applyQuaternion","setFromVector3","rotateLeft","sphericalDelta","min","max","Number","isFinite","makeSafe","radius","addScaledVector","panOffset","setFromSpherical","lookAt","multiplyScalar","zoomChanged","distanceToSquared","EPS","dot","quaternion","removeEventListener","onContextMenu","onPointerDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","ownerDocument","onPointerMove","onPointerUp","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","Vector2","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","pow","angle","rotateUp","panLeft","v","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","element","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","matrix","dollyOut","dollyScale","dollyIn","handleMouseDownRotate","clientX","clientY","handleMouseDownPan","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","dx","dy","sqrt","handleTouchMoveRotate","subVectors","handleTouchMovePan","handleTouchMoveDolly","pointerType","preventDefault","focus","mouseAction","button","handleMouseDownDolly","ctrlKey","metaKey","shiftKey","onMouseDown","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","onMouseMove","onMouseUp","handleMouseWheel","needsUpdate","code","handleKeyDown","handleTouchStartDollyPan","handleTouchStartDollyRotate","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","passive","EventDispatcher","WorldInteractionControls","gameWorld","handleClick","handleMouseMove","getMouseRaycaster","Raycaster","mouse","setFromCamera","intersecs","handleLeftClick","handleRightClick","point","GameControls","cameraMapControls","worldInteractionControls","timer","Object3DHelper","cloneObject3D","recursive","cloneMaterials","newObject","traverse","mesh","isMesh","cloneMaterial","setShadows","newMaterial","im","isMaterial","_path","_path2","_path3","Game","gameRenderer","gameControls","modelLoader","gameStateDataService","connectToServer","connectionAtempt","handleConnectedToServer","connected","handleServerCreateUnit","handleServerSetUnit","setTimeout","log","pos","createMoveableTower","handleLoadModelsCompleted","resp","unit","handleActionbarButtonClicked","tower","well","handleGameObjectReachedDestination","posX","posZ","createMoveableGameObject","createMoveableWell","modelKey","gameObj","Scene","PerspectiveCamera","withSvgIcon","WrappedSvgIcon","defaultProps","defaultPropValues","fill","svgProps","PureComponent","_excluded","_extends","assign","i","arguments","prototype","hasOwnProperty","apply","_objectWithoutProperties","excluded","sourceKeys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgTowerIcon","_ref","svgRef","title","titleId","xmlns","viewBox","xmlSpace","ref","ForwardRef","SvgWellIcon","TowerIcon","TowerIconSVG","WellIcon","WellIconSVG","BasicUI","handleButtonClick","onClickButton","nativeEvent","onClick","GameContainer","initialized","game","gameContainer","initGame","HomeContainer","padding","to","fontSize","App","basename","exact","optionalParams","logCount","logC","mod","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.c6092017.chunk.js","sourcesContent":["import { Object3D } from 'three'\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader'\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\n\nexport interface GameModel {\n\tpath: string\n\tname: string\n\tonLoaded?: (model: LoadedGameModel) => void\n}\nexport interface LoadedGameModel extends GameModel {\n\tobject: Object3D\n}\n\nexport interface LoadedModels {\n\t[property: string]: LoadedGameModel\n}\nclass ModelLoader {\n\tprivate baseUrl: string\n\n\tprivate gltfLoader: GLTFLoader\n\n\tprivate dracoLoader: DRACOLoader\n\n\tpublic loadedModels: LoadedModels\n\n\tconstructor(baseUrl = '') {\n\t\tthis.baseUrl = baseUrl\n\t\tthis.gltfLoader = new GLTFLoader()\n\t\tthis.dracoLoader = new DRACOLoader()\n\t\tthis.loadedModels = {}\n\t}\n\n\tpublic initialize = (): void => {\n\t\t// this.dracoLoader.setDecoderPath('/assets/draco/')\n\t\t// this.gltfLoader.setDRACOLoader(this.dracoLoader)\n\t}\n\n\tpublic loadModels = (models: GameModel[], completeCallback: (loadedModels: LoadedModels) => void): void => {\n\t\tlet loadCount = 0\n\t\tmodels.forEach((m) => {\n\t\t\tthis.loadModel(m, (loadedModel) => {\n\t\t\t\tthis.loadedModels = {\n\t\t\t\t\t...this.loadedModels,\n\t\t\t\t\t[loadedModel.name]: loadedModel\n\t\t\t\t}\n\t\t\t\tloadCount += 1\n\t\t\t\tif (m.onLoaded) {\n\t\t\t\t\tm.onLoaded(loadedModel)\n\t\t\t\t}\n\t\t\t\tif (loadCount === models.length) {\n\t\t\t\t\tcompleteCallback(this.loadedModels)\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\tprivate loadModel = (gameModel: GameModel, callback: (model: LoadedGameModel) => void): void => {\n\t\tthis.gltfLoader.load(`${this.baseUrl}${gameModel.path}`, (gltf) => {\n\t\t\tcallback({\n\t\t\t\t...gameModel,\n\t\t\t\tobject: gltf.scene\n\t\t\t})\n\t\t})\n\t}\n}\n\nexport default ModelLoader\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable no-param-reassign */\n/* eslint-disable @typescript-eslint/explicit-function-return-type */\n/* eslint-disable symbol-description */\n/* eslint-disable @typescript-eslint/no-this-alias */\n/* eslint-disable no-restricted-syntax */\nexport interface OnPropertyChangeConfig {\n\thistory?: boolean\n\tbulk?: boolean\n}\n\nconst valuesCacheKey = Symbol()\nconst lastCallKey = Symbol()\n\nconst defaultConfig = {\n\tbulk: false,\n\thistory: false\n}\nexport interface PropertyChange<T> {\n\tfirstChange: boolean\n\tpreviousValue: T\n\tcurrentValue: T\n}\n\nexport function OnChange(props: string | string[], config: OnPropertyChangeConfig = defaultConfig): MethodDecorator {\n\tconst propertyNames = normaliseProps(props)\n\n\treturn (clazz: any, methodName: PropertyKey): void => {\n\t\tfor (const propertyName of propertyNames) {\n\t\t\tconst originalDescriptor = Object.getOwnPropertyDescriptor(clazz, propertyName)\n\n\t\t\tObject.defineProperty(clazz, propertyName, {\n\t\t\t\tset(value) {\n\t\t\t\t\tconst instance = this\n\n\t\t\t\t\tif (value === instance[propertyName]) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tensureHiddenProps(instance)\n\t\t\t\t\tupdateValueCache(instance, propertyName, value)\n\n\t\t\t\t\tif (originalDescriptor) {\n\t\t\t\t\t\toriginalDescriptor.set?.call(instance, value)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (shouldCallTargetMethod(clazz, instance, methodName, propertyNames, config)) {\n\t\t\t\t\t\tcallTargetMethod(clazz, instance, methodName, propertyNames, config)\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tget() {\n\t\t\t\t\tconst instance = this\n\t\t\t\t\tif (originalDescriptor) {\n\t\t\t\t\t\treturn originalDescriptor.get?.call(instance)\n\t\t\t\t\t}\n\t\t\t\t\tconst cache = instance[valuesCacheKey] && instance[valuesCacheKey][propertyName]\n\t\t\t\t\treturn cache ? cache.currentValue : undefined\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n}\n\n// This line is here for compatibility with older versions\nexport const OnPropertyChange = OnChange\n\nfunction normaliseProps(props: string | string[]): string[] {\n\tif (Array.isArray(props)) {\n\t\treturn props as unknown as string[]\n\t}\n\treturn [props as unknown as string]\n}\n\nfunction ensureHiddenProps(instance: any) {\n\tif (!instance[valuesCacheKey]) {\n\t\tinstance[valuesCacheKey] = {}\n\t}\n\tif (!instance[lastCallKey]) {\n\t\tinstance[lastCallKey] = {}\n\t}\n}\n\nfunction updateValueCache(instance: any, propName: any, value: any) {\n\tif (instance[valuesCacheKey][propName]) {\n\t\tinstance[valuesCacheKey][propName].firstChange = false\n\t} else {\n\t\tinstance[valuesCacheKey][propName] = { firstChange: true }\n\t}\n\n\tconst cache = instance[valuesCacheKey][propName]\n\tcache.previousValue = cache.currentValue\n\tcache.currentValue = value\n}\n\nfunction shouldCallTargetMethod(clazz: any, instance: any, methodName: PropertyKey, props: string[], config: OnPropertyChangeConfig): boolean {\n\tconst definedPropNames = Object.keys(instance[valuesCacheKey])\n\tconst allPropsDefined = props.every((name) => definedPropNames.includes(name))\n\tif (allPropsDefined) {\n\t\tif (config.bulk) {\n\t\t\tconst neverCalled = !instance[lastCallKey][methodName]\n\t\t\treturn neverCalled || props.every((p) => instance[valuesCacheKey][p].currentValue !== instance[lastCallKey][methodName][p])\n\t\t}\n\t\treturn true\n\t}\n\n\treturn false\n}\n\nfunction callTargetMethod(clazz: any, instance: any, methodName: PropertyKey, props: string[], config: OnPropertyChangeConfig): void {\n\tconst valueMap = instance[valuesCacheKey]\n\tconst mapper = config.history ? (p: any) => valueMap[p] : (p: any) => valueMap[p].currentValue\n\tconst values = props.map(mapper)\n\n\tclazz[methodName].call(instance, ...values)\n\n\tinstance[lastCallKey][methodName] = props.reduce((obj, p) => ({ ...obj, [p]: valueMap[p].currentValue }), {})\n}\n","import { AmbientLight, Color, DirectionalLight, Fog, GridHelper, LineBasicMaterial, Mesh, MeshLambertMaterial, PlaneGeometry, RepeatWrapping, Scene, sRGBEncoding, TextureLoader } from 'three'\n\nexport enum WorldEnviromentDebugEnum {\n\tShowSmallGrid,\n\tShowMediumGrid,\n\tShowLargeGrid\n}\nclass WorldEnviroment {\n\tprivate scene: Scene\n\n\tprivate debugOptions: {\n\t\t[key in keyof typeof WorldEnviromentDebugEnum]?: boolean\n\t}\n\n\tconstructor(scene: Scene) {\n\t\tthis.scene = scene\n\t\tthis.debugOptions = {}\n\t}\n\n\tpublic initialize = (): void => {\n\t\t// lights\n\t\tconst ambientLight = new AmbientLight(0x666666, 0.6)\n\t\tthis.scene.add(ambientLight)\n\n\t\tconst light = new DirectionalLight(0xdfebff, 0.7)\n\t\tlight.position.set(500, 800, 500)\n\n\t\tlight.castShadow = true\n\t\tlight.shadow.bias = -0.0001\n\t\tlight.shadow.mapSize.width = 10000\n\t\tlight.shadow.mapSize.height = 10000\n\n\t\tconst d = 500\n\n\t\tlight.shadow.camera.left = -d\n\t\tlight.shadow.camera.right = d\n\t\tlight.shadow.camera.top = d\n\t\tlight.shadow.camera.bottom = -d\n\n\t\t// light.shadow.camera.near = 10\n\t\tlight.shadow.camera.far = 2000\n\n\t\tthis.scene.add(light)\n\n\t\t// ground\n\t\tconst textureLoader = new TextureLoader()\n\t\tconst groundTexture = textureLoader.load('assets/textures/terrain/grasslight-big.jpg')\n\n\t\tgroundTexture.wrapS = RepeatWrapping\n\t\tgroundTexture.wrapT = RepeatWrapping\n\t\tgroundTexture.repeat.set(200, 200)\n\t\tgroundTexture.anisotropy = 16\n\t\tgroundTexture.encoding = sRGBEncoding\n\n\t\tconst groundMaterial = new MeshLambertMaterial({ map: groundTexture })\n\t\tconst groundMesh = new Mesh(new PlaneGeometry(1000, 1000), groundMaterial)\n\n\t\tgroundMesh.rotation.x = -Math.PI / 2\n\t\tgroundMesh.receiveShadow = true\n\t\tthis.scene.add(groundMesh)\n\n\t\t// sky and fog\n\t\tthis.scene.background = new Color(0xcce0ff)\n\t\tthis.scene.fog = new Fog(0xcce0ff, 75, 150)\n\n\t\t// this.scene.environment = pmremGenerator.fromScene(new RoomEnvironment()).texture\n\t\t// this.scene.fog = new THREE.Fog(0xcccccc, 10, 50)\n\t\tthis.initializeDebug()\n\t}\n\n\tpublic setDebug = (...debug: WorldEnviromentDebugEnum[]): void => {\n\t\tdebug.forEach((d) => {\n\t\t\tthis.debugOptions = {\n\t\t\t\t...this.debugOptions,\n\t\t\t\t[WorldEnviromentDebugEnum[d]]: true\n\t\t\t}\n\t\t})\n\t}\n\n\tprivate initializeDebug = (): void => {\n\t\tif (this.debugOptions.ShowSmallGrid) {\n\t\t\tconst smallGrid = new GridHelper(1000, 1000, 0xcccccc, 0xcccccc)\n\t\t\tthis.scene.add(smallGrid)\n\t\t}\n\n\t\tif (this.debugOptions.ShowMediumGrid) {\n\t\t\tconst mediumGrid = new GridHelper(1000, 100, 0x333333, 0x333333)\n\t\t\tconst mediumGridMaterial = mediumGrid.material as LineBasicMaterial\n\t\t\tmediumGridMaterial.linewidth = 3\n\t\t\tthis.scene.add(mediumGrid)\n\t\t}\n\n\t\tif (this.debugOptions.ShowLargeGrid) {\n\t\t\tconst largeGrid = new GridHelper(1000, 10, 0x999999, 0x999999)\n\t\t\tconst largeGridMaterial = largeGrid.material as LineBasicMaterial\n\t\t\tlargeGridMaterial.linewidth = 5\n\t\t\tthis.scene.add(largeGrid)\n\t\t}\n\t}\n}\n\nexport default WorldEnviroment\n","import { OnChange } from '../../infrastructure/decorators/onPropertyChange'\n\nexport interface ICordinates {\n\tx: number\n\ty: number\n\tz: number\n}\nexport interface IGameObjectWorldData {\n\tposition: ICordinates\n\trotation: ICordinates\n\tdestination: ICordinates\n\tscale: number\n\tcastShadow: boolean\n\treceiveShadow: boolean\n\tselected: boolean\n\thighlighted: boolean\n\tisDirty: boolean\n}\n\nclass GameObjectWorldData implements IGameObjectWorldData {\n\tpublic position: ICordinates = { x: 0, y: 0, z: 0 }\n\n\tpublic rotation: ICordinates = { x: 0, y: 0, z: 0 }\n\n\tpublic destination: ICordinates = this.position\n\n\tpublic isDirty = false\n\n\tpublic scale = 1\n\n\tpublic castShadow = false\n\n\tpublic receiveShadow = false\n\n\tpublic selected = false\n\n\tpublic highlighted = false\n\n\t@OnChange(['selected', 'highlighted', 'position', 'scale', 'rotation'])\n\tprotected setDirty(): void {\n\t\tthis.isDirty = true\n\t}\n\n\tprotected clearDirty(): void {\n\t\tthis.isDirty = false\n\t}\n}\n\nexport default GameObjectWorldData\n","import { Object3D } from 'three'\nimport GameObject, { IGameObject } from './gameObject'\nimport GameObjectWorldData, { ICordinates, IGameObjectWorldData } from './gameObjectWorldData'\n\nexport type IMoveableGameObject = IGameObject\n\nclass MoveableGameObject extends GameObject implements IMoveableGameObject {\n\tpublic movementSpeed = 5\n\n\tpublic destinationReached?: (obj: this) => void\n\n\tconstructor(key: string, model: Object3D, worldData: IGameObjectWorldData = new GameObjectWorldData()) {\n\t\tsuper(key, model, worldData)\n\t\tthis.worldData = worldData\n\t\tthis.renderedWorldData = new GameObjectWorldData()\n\t}\n\n\tpublic update(time: number, delta: number): void {\n\t\tconst updateData = this.updateData<IGameObjectWorldData>()\n\t\tupdateData('destination')\n\n\t\tconst { worldData } = this\n\t\tif (worldData.position.x !== worldData.destination.x || worldData.position.z !== worldData.destination.z) {\n\t\t\tworldData.position = this.move(worldData.position, worldData.destination, delta)\n\t\t\tif (worldData.position.x === worldData.destination.x && worldData.position.z === worldData.destination.z) {\n\t\t\t\tif (this.destinationReached) {\n\t\t\t\t\tthis.destinationReached(this)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tsuper.update(time, delta)\n\t\t// updateData('position')\n\t}\n\n\tprivate move(source: ICordinates, destination: ICordinates, delta: number): ICordinates {\n\t\treturn {\n\t\t\tx: this.getDistanceToMove(source.x, destination.x, delta),\n\t\t\ty: this.getDistanceToMove(source.y, destination.y, delta),\n\t\t\tz: this.getDistanceToMove(source.z, destination.z, delta)\n\t\t}\n\t}\n\n\tprivate getDistanceToMove = (source: number, destination: number, delta: number): number => {\n\t\tlet newPostion: number = source\n\t\tlet moveDistance = delta * this.movementSpeed\n\t\tconst diff = Math.abs(destination - source)\n\t\tif (diff === 0) {\n\t\t\treturn destination\n\t\t}\n\t\tif (diff < moveDistance) {\n\t\t\tmoveDistance = diff\n\t\t}\n\t\tif (source > destination) {\n\t\t\tnewPostion = source - moveDistance\n\t\t}\n\t\tif (source < destination) {\n\t\t\tnewPostion = source + moveDistance\n\t\t}\n\t\treturn newPostion\n\t}\n}\nexport default MoveableGameObject\n","import { Group, Mesh, MeshBasicMaterial, Object3D, RingGeometry } from 'three'\nimport { CSS2DObject } from 'three/examples/jsm/renderers/CSS2DRenderer'\nimport GameObjectWorldData, { IGameObjectWorldData } from './gameObjectWorldData'\n\nexport interface IGameObject {\n\tworldData: IGameObjectWorldData\n\tmodel: Object3D\n\tkey: string\n\tupdate: (time: number, delta: number) => void\n}\nclass GameObject implements IGameObject {\n\tpublic key: string\n\n\tpublic model: Object3D\n\n\tpublic textContainer: HTMLDivElement\n\n\tpublic lastTextUpdate = 0\n\n\tpublic selectedCircleMesh: Mesh<RingGeometry, MeshBasicMaterial>\n\n\tpublic worldData: IGameObjectWorldData\n\n\tprotected renderedWorldData: IGameObjectWorldData\n\n\tconstructor(key: string, model: Object3D, worldData: IGameObjectWorldData = new GameObjectWorldData()) {\n\t\tthis.key = key\n\t\tthis.worldData = worldData\n\t\tthis.renderedWorldData = new GameObjectWorldData()\n\n\t\tconst geometry = new RingGeometry(3.5, 3.6, 32)\n\t\tconst material = new MeshBasicMaterial({ color: 0x3336699 })\n\t\tthis.selectedCircleMesh = new Mesh<RingGeometry, MeshBasicMaterial>(geometry, material)\n\t\tthis.selectedCircleMesh.rotation.x = -Math.PI / 2\n\t\tthis.selectedCircleMesh.position.y = 0\n\t\tthis.selectedCircleMesh.visible = false\n\n\t\tthis.textContainer = document.createElement('div')\n\t\tthis.textContainer.className = 'text-label'\n\t\tthis.textContainer.style.marginTop = '-1em'\n\t\tconst textLabel = new CSS2DObject(this.textContainer)\n\t\ttextLabel.position.set(0, 8, 0)\n\n\t\tconst newGroup = new Group()\n\t\tnewGroup.add(textLabel)\n\t\tnewGroup.add(this.selectedCircleMesh)\n\t\tnewGroup.add(model.clone())\n\t\tnewGroup.userData = {\n\t\t\tgameObjectKey: key\n\t\t}\n\t\tthis.model = newGroup\n\t}\n\n\tprivate circle = (show: boolean, event: 'highlighted' | 'selected'): void => {\n\t\tthis.selectedCircleMesh.visible = show\n\t\tif (event === 'highlighted') this.selectedCircleMesh.material.color.setHex(0x333333)\n\t\tif (event === 'selected') this.selectedCircleMesh.material.color.setHex(0x336699)\n\t}\n\n\tprotected updateDataBase =\n\t\t<T>() =>\n\t\t<K extends keyof T>(source: T, dest: T, prop: K, updateCallback: ((value: T[K]) => void) | undefined = undefined): void => {\n\t\t\tconst destProp = dest[prop]\n\t\t\tif (destProp !== source[prop]) {\n\t\t\t\tif (updateCallback) updateCallback(source[prop])\n\t\t\t}\n\t\t}\n\n\tprotected updateData =\n\t\t<T extends unknown>() =>\n\t\t<K extends keyof T>(prop: K, updateCallback: ((value: T[K]) => void) | undefined = undefined): void => {\n\t\t\tconst worldData = this.worldData as T\n\t\t\tconst renderedWorldData = this.renderedWorldData as T\n\t\t\tthis.updateDataBase<T>()(worldData, renderedWorldData, prop, (newValue) => {\n\t\t\t\tif (updateCallback) updateCallback(newValue)\n\t\t\t\trenderedWorldData[prop] = newValue\n\t\t\t})\n\t\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tpublic update(time: number, delta: number): void {\n\t\tif (!this.worldData.isDirty) {\n\t\t\treturn\n\t\t}\n\t\tconst updateData = this.updateData<IGameObjectWorldData>()\n\t\tupdateData('scale', (scale) => {\n\t\t\tthis.model.scale.setScalar(scale)\n\t\t})\n\t\tupdateData('position', (newPosition) => {\n\t\t\tthis.model.position.x = newPosition.x\n\t\t\tthis.model.position.y = newPosition.y\n\t\t\tthis.model.position.z = newPosition.z\n\t\t})\n\n\t\tupdateData('selected', (selected) => {\n\t\t\tthis.circle(selected || this.worldData.highlighted, 'selected')\n\t\t})\n\t\tupdateData('rotation', (newRotation) => {\n\t\t\tthis.model.rotation.x = newRotation.x\n\t\t\tthis.model.rotation.y = newRotation.y\n\t\t\tthis.model.rotation.z = newRotation.z\n\t\t})\n\t\tupdateData('highlighted', (highlighted) => {\n\t\t\tthis.circle(highlighted || this.worldData.selected, 'highlighted')\n\t\t})\n\t\tif (this.lastTextUpdate + 100 <= time || this.lastTextUpdate === 0) {\n\t\t\tthis.textContainer.innerHTML = `renderTime: ${time.toString()}<br />`\n\t\t\tthis.lastTextUpdate = time\n\t\t}\n\t\tthis.worldData.isDirty = false\n\t}\n}\nexport default GameObject\n","import { ConnectResponse, CreateUnitRequest, CreateUnitResponse, GameState } from './models'\nimport SetUnitMessage from './models/setUnitMessage'\n\ninterface WebsocketMessages {\n\tCreatUnit: CreateUnitResponse\n\tSetUnit: SetUnitMessage\n}\n\ntype WebsocketMessageType = keyof WebsocketMessages\ntype WebsocketMessage = WebsocketMessages[WebsocketMessageType]\n\ntype MessageHandlerCallback<TMessage> = (message: TMessage) => void\ntype AddMessageHandler = <TMessageKey extends WebsocketMessageType>(type: TMessageKey, handler: MessageHandlerCallback<WebsocketMessages[TMessageKey]>) => void\ninterface MessageHandler {\n\ttype: WebsocketMessageType\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\thandler: MessageHandlerCallback<any & WebsocketMessage>\n}\n\nclass GameStateDataService {\n\tprivate apiUri: string\n\n\tprivate wsUri: string\n\n\tprivate socket: WebSocket | undefined\n\n\tprivate messageHandlers: MessageHandler[]\n\n\tconstructor() {\n\t\tthis.apiUri = process.env.REACT_APP_SERVER_API\n\t\tthis.wsUri = process.env.REACT_APP_SERVER_WS\n\n\t\tthis.messageHandlers = []\n\t}\n\n\tpublic connectToWebsocket = (userId: number): Promise<boolean> =>\n\t\tnew Promise<boolean>((resolve, reject) => {\n\t\t\tfetch(`${this.apiUri}/register`, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\tmode: 'cors',\n\t\t\t\theaders: {\n\t\t\t\t\tAccept: 'application/json',\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({ user_id: userId })\n\t\t\t})\n\t\t\t\t.then((r) => {\n\t\t\t\t\treturn r.json()\n\t\t\t\t})\n\t\t\t\t.then((r: ConnectResponse): string => {\n\t\t\t\t\treturn r.url\n\t\t\t\t})\n\t\t\t\t.then((url) => {\n\t\t\t\t\tconst socket = new WebSocket(`${this.wsUri}/${url}`)\n\t\t\t\t\tsocket.onopen = () => {\n\t\t\t\t\t\tsocket.onmessage = this.onMessageRecived\n\t\t\t\t\t\tthis.socket = socket\n\t\t\t\t\t\tresolve(true)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(() => reject())\n\t\t})\n\n\tpublic createUnit = (x: number, z: number): void => {\n\t\tthis.socket?.send(JSON.stringify({ CreatUnit: { position: [x, z] } } as CreateUnitRequest))\n\t}\n\n\tpublic setUnit = (id: string, x: number, z: number): void => {\n\t\tthis.socket?.send(JSON.stringify({ SetUnit: { position: [x, z], id } }))\n\t}\n\n\tpublic fetchInitialGameState = (): Promise<GameState> =>\n\t\tnew Promise<GameState>((resolve, reject) => {\n\t\t\tfetch(`${this.apiUri}/game`)\n\t\t\t\t.then((response) => response.json())\n\t\t\t\t.then((state: GameState) => resolve(state))\n\t\t\t\t.catch(() => reject())\n\t\t})\n\n\tpublic addMessageHandler: AddMessageHandler = (type, handler) => {\n\t\tthis.messageHandlers = [...this.messageHandlers, { type, handler }]\n\t}\n\n\tprivate notifyHandlers = (type: WebsocketMessageType, message: WebsocketMessage): void => {\n\t\tthis.messageHandlers.filter((h) => h.type === type).forEach((handler) => handler.handler(message))\n\t}\n\n\tprivate onMessageRecived = (e: MessageEvent): void => {\n\t\tconst msg: WebsocketMessage = JSON.parse(e.data)\n\t\tif ((msg as CreateUnitResponse).CreatUnit) {\n\t\t\tthis.notifyHandlers('CreatUnit', msg)\n\t\t}\n\t\tif ((msg as SetUnitMessage).SetUnit) {\n\t\t\tthis.notifyHandlers('SetUnit', msg)\n\t\t}\n\t}\n}\n\nexport default GameStateDataService\n","import { Intersection, Object3D, Raycaster, Scene } from 'three'\nimport { IGameObject } from './gameObjects/gameObject'\nimport { ICordinates, IGameObjectWorldData } from './gameObjects/gameObjectWorldData'\nimport MoveableGameObject from './gameObjects/moveableGameObject'\nimport { IUpdate } from './gameRenderer'\nimport WorldEnviroment, { WorldEnviromentDebugEnum } from './worldEnviroment'\n\nclass GameWorld implements IUpdate {\n\tprivate scene: Scene\n\n\tpublic gameObjects: IGameObject[]\n\n\tprivate worldEnviroment: WorldEnviroment\n\n\tconstructor(scene: Scene) {\n\t\tthis.scene = scene\n\t\tthis.worldEnviroment = new WorldEnviroment(scene)\n\t\tthis.gameObjects = []\n\t}\n\n\tpublic initialize = (): void => {\n\t\tthis.worldEnviroment.setDebug(WorldEnviromentDebugEnum.ShowMediumGrid, WorldEnviromentDebugEnum.ShowLargeGrid)\n\t\tthis.worldEnviroment.initialize()\n\t}\n\n\tpublic update = (time: number, delta: number): void => {\n\t\tthis.gameObjects.forEach((gm) => gm.update(time, delta))\n\t}\n\n\tpublic addGameObject = (gameObject: IGameObject): void => {\n\t\tthis.scene.add(gameObject.model)\n\t\tthis.gameObjects = [...this.gameObjects, gameObject]\n\t}\n\n\tpublic setGameObject = <K extends keyof IGameObjectWorldData>(id: string, prop: K, value: IGameObjectWorldData[K]): void => {\n\t\tthis.gameObjects\n\t\t\t.filter((x) => x.key === id)\n\t\t\t.forEach((g) => {\n\t\t\t\tconst gameObject = g\n\t\t\t\tgameObject.worldData[prop] = value\n\t\t\t})\n\t}\n\n\tpublic getSceneIntersection = (raycaster: Raycaster): Intersection[] => {\n\t\treturn raycaster.intersectObject(this.scene, true)\n\t}\n\n\tpublic moveSelectedGameObjects = (destination: ICordinates): void => {\n\t\tthis.gameObjects\n\t\t\t.filter((x) => x.worldData.selected)\n\t\t\t.forEach((go) => {\n\t\t\t\tif (go instanceof MoveableGameObject) {\n\t\t\t\t\tconst { worldData } = go\n\t\t\t\t\tworldData.destination = {\n\t\t\t\t\t\t...worldData.destination,\n\t\t\t\t\t\tx: destination.x,\n\t\t\t\t\t\tz: destination.z\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\tpublic getGameObjectIntersection = (raycaster: Raycaster): IGameObject | null => {\n\t\tconst intersects = raycaster.intersectObjects(\n\t\t\tthis.gameObjects.map((go) => go.model),\n\t\t\ttrue\n\t\t)\n\t\tlet intersectedModel: IGameObject | null = null\n\t\tintersects.forEach((intersection): void => {\n\t\t\tconst gameModel = this.getGameObjectRoot(intersection.object)\n\t\t\tif (!intersectedModel && gameModel) {\n\t\t\t\tintersectedModel = gameModel\n\t\t\t}\n\t\t})\n\n\t\treturn intersectedModel\n\t}\n\n\tpublic hoverGameObject = (gameObject: IGameObject | null = null): void => {\n\t\tthis.gameObjects\n\t\t\t.filter((x) => x.worldData.highlighted || (gameObject !== null && x.key === gameObject.key))\n\t\t\t.forEach((go) => {\n\t\t\t\tconst { worldData } = go\n\t\t\t\tif (gameObject !== null && go.key === gameObject.key) {\n\t\t\t\t\tworldData.highlighted = true\n\t\t\t\t} else {\n\t\t\t\t\tworldData.highlighted = false\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\tpublic selectGameObject = (gameObject: IGameObject | null = null, removeExsistingSelection: boolean): void => {\n\t\tthis.gameObjects\n\t\t\t.filter((x) => x.worldData.selected || (gameObject !== null && x.key === gameObject.key))\n\t\t\t.forEach((go) => {\n\t\t\t\tconst { worldData } = go\n\t\t\t\tif (gameObject !== null && go.key === gameObject.key) {\n\t\t\t\t\tworldData.selected = true\n\t\t\t\t} else if (removeExsistingSelection) {\n\t\t\t\t\tworldData.selected = false\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\tprivate getGameObjectByKey = (key: string): IGameObject | null => {\n\t\tconst objects = this.gameObjects.filter((gm) => gm.key === key)\n\t\tif (objects.length > 0) return objects[0]\n\t\treturn null\n\t}\n\n\tprivate getGameObjectRoot = (object: Object3D): IGameObject | null => {\n\t\tif (object.userData.gameObjectKey) {\n\t\t\treturn this.getGameObjectByKey(object.userData.gameObjectKey)\n\t\t}\n\t\tif (object.parent) {\n\t\t\treturn this.getGameObjectRoot(object.parent)\n\t\t}\n\t\treturn null\n\t}\n}\n\nexport default GameWorld\n","import Stats from 'three/examples/jsm/libs/stats.module'\nimport { Clock, PerspectiveCamera, Scene, sRGBEncoding, WebGLRenderer } from 'three'\n\nimport { CSS2DRenderer } from 'three/examples/jsm/renderers/CSS2DRenderer.js'\n\nexport interface IUpdate {\n\tupdate: (timer: number, delta: number) => void\n}\nclass GameRenderer {\n\tprivate camera: PerspectiveCamera\n\n\tprivate scene: Scene\n\n\tprivate container: HTMLElement\n\n\tprivate renderer: WebGLRenderer\n\n\tprivate labelRenderer: CSS2DRenderer\n\n\tprivate clock: Clock\n\n\tprivate stats: Stats\n\n\tprivate fps = 60\n\n\tprivate lastRender = Date.now()\n\n\tprivate updateTargets: IUpdate[]\n\n\tconstructor(container: HTMLElement, scene: Scene, camera: PerspectiveCamera) {\n\t\tthis.container = container\n\t\tthis.scene = scene\n\t\tthis.camera = camera\n\t\tthis.renderer = new WebGLRenderer({ antialias: true })\n\t\tthis.clock = new Clock()\n\t\tthis.updateTargets = []\n\t\tthis.labelRenderer = new CSS2DRenderer()\n\t\tthis.stats = Stats()\n\t}\n\n\tpublic initialize = (): void => {\n\t\t// init rendere\n\n\t\tthis.renderer.setPixelRatio(window.devicePixelRatio)\n\t\tthis.renderer.setSize(window.innerWidth, window.innerHeight)\n\n\t\tthis.renderer.outputEncoding = sRGBEncoding\n\t\tthis.renderer.shadowMap.enabled = true\n\t\t// this.renderer.toneMapping = ACESFilmicToneMapping\n\t\t// this.renderer.toneMappingExposure = 0.85\n\n\t\tthis.labelRenderer.setSize(window.innerWidth, window.innerHeight)\n\t\tthis.labelRenderer.domElement.style.position = 'absolute'\n\t\tthis.labelRenderer.domElement.style.top = '0px'\n\n\t\twindow.addEventListener('resize', this.handleWindowResize)\n\t\tthis.container.appendChild(this.renderer.domElement)\n\t\tthis.container.appendChild(this.labelRenderer.domElement)\n\t\tthis.container.appendChild(this.stats.dom)\n\t}\n\n\tprivate handleWindowResize = (/* event: UIEvent */): void => {\n\t\tthis.camera.aspect = window.innerWidth / window.innerHeight\n\t\tthis.camera.updateProjectionMatrix()\n\t\tthis.renderer.setSize(window.innerWidth, window.innerHeight)\n\t\tthis.labelRenderer.setSize(window.innerWidth, window.innerHeight)\n\t}\n\n\tpublic addUpdateTarget = (updateTarget: IUpdate): void => {\n\t\tthis.updateTargets = [...this.updateTargets, updateTarget]\n\t}\n\n\tpublic start = (): void => {\n\t\trequestAnimationFrame(this.renderLoop)\n\t}\n\n\tprivate renderLoop = (time: number): void => {\n\t\tconst now = Date.now()\n\t\tconst lastRenderDiff = now - this.lastRender\n\t\tconst interval = 1000 / this.fps\n\t\tif (lastRenderDiff > interval) {\n\t\t\tconst delta = this.clock.getDelta()\n\t\t\t// this.gameWorld.update(time, delta)\n\t\t\tthis.updateTargets.forEach((updateTarget) => updateTarget.update(time, delta))\n\t\t\tthis.stats.update()\n\t\t\tthis.lastRender = now - (lastRenderDiff % interval)\n\t\t\tthis.renderer.render(this.scene, this.camera)\n\t\t\tthis.labelRenderer.render(this.scene, this.camera)\n\t\t}\n\t\trequestAnimationFrame(this.renderLoop)\n\t}\n}\nexport default GameRenderer\n","/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable no-console */\n/* eslint-disable @typescript-eslint/no-this-alias */\n/* eslint-disable no-restricted-properties */\n/* eslint-disable @typescript-eslint/no-shadow */\nimport { EventDispatcher, Matrix4, MOUSE, PerspectiveCamera, Quaternion, Spherical, TOUCH, Vector2, Vector3 } from 'three'\n\nconst changeEvent = { type: 'change' }\nconst startEvent = { type: 'start' }\nconst endEvent = { type: 'end' }\ninterface ICameraOrbitControls {\n\tcamera: PerspectiveCamera\n\tdomElement: HTMLElement\n\n\t// API\n\tenabled: boolean\n\ttarget: Vector3\n\n\tminDistance: number\n\tmaxDistance: number\n\n\tminZoom: number\n\tmaxZoom: number\n\n\tminPolarAngle: number\n\tmaxPolarAngle: number\n\n\tminAzimuthAngle: number\n\tmaxAzimuthAngle: number\n\n\tenableDamping: boolean\n\tdampingFactor: number\n\n\tenableZoom: boolean\n\tzoomSpeed: number\n\n\tenableRotate: boolean\n\trotateSpeed: number\n\n\tenablePan: boolean\n\tpanSpeed: number\n\tscreenSpacePanning: boolean\n\tkeyPanSpeed: number\n\n\tautoRotate: boolean\n\tautoRotateSpeed: number\n\n\tkeys: { LEFT: string; UP: string; RIGHT: string; BOTTOM: string }\n\tmouseButtons: { LEFT: MOUSE; MIDDLE: MOUSE; RIGHT: MOUSE }\n\ttouches: { ONE: TOUCH; TWO: TOUCH }\n\n\tupdate(): boolean\n\n\tlistenToKeyEvents(domElement: HTMLElement): void\n\n\tsaveState(): void\n\n\treset(): void\n\n\tdispose(): void\n\n\tgetPolarAngle(): number\n\n\tgetAzimuthalAngle(): number\n}\n\nclass CameraOrbitControls extends EventDispatcher implements ICameraOrbitControls {\n\tcamera: PerspectiveCamera\n\n\tdomElement: HTMLElement\n\n\tenabled: boolean\n\n\ttarget: Vector3\n\n\tminDistance: number\n\n\tmaxDistance: number\n\n\tminZoom: number\n\n\tmaxZoom: number\n\n\tminPolarAngle: number\n\n\tmaxPolarAngle: number\n\n\tminAzimuthAngle: number\n\n\tmaxAzimuthAngle: number\n\n\tenableDamping: boolean\n\n\tdampingFactor: number\n\n\tenableZoom: boolean\n\n\tzoomSpeed: number\n\n\tenableRotate: boolean\n\n\trotateSpeed: number\n\n\tenablePan: boolean\n\n\tpanSpeed: number\n\n\tscreenSpacePanning: boolean\n\n\tkeyPanSpeed: number\n\n\tautoRotate: boolean\n\n\tautoRotateSpeed: number\n\n\tkeys: { LEFT: string; UP: string; RIGHT: string; BOTTOM: string }\n\n\tmouseButtons: { LEFT: MOUSE; MIDDLE: MOUSE; RIGHT: MOUSE }\n\n\ttouches: { ONE: TOUCH; TWO: TOUCH }\n\n\ttarget0: Vector3\n\n\tposition0: Vector3\n\n\tzoom0: number\n\n\tdomElementKeyEvents: HTMLElement | null\n\n\tgetPolarAngle: () => number\n\n\tgetAzimuthalAngle: () => number\n\n\tlistenToKeyEvents: (domElement: HTMLElement) => void\n\n\tsaveState: () => void\n\n\treset: () => void\n\n\tdispose: () => void\n\n\tupdate = (): boolean => true\n\n\tconstructor(camera: PerspectiveCamera, domElement: HTMLElement) {\n\t\tsuper()\n\n\t\tif (domElement === undefined) console.warn('THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.')\n\n\t\tthis.camera = camera\n\t\tthis.domElement = domElement\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3()\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0\n\t\tthis.maxDistance = Infinity\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0\n\t\tthis.maxZoom = Infinity\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0 // radians\n\t\tthis.maxPolarAngle = Math.PI // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = -Infinity // radians\n\t\tthis.maxAzimuthAngle = Infinity // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false\n\t\tthis.dampingFactor = 0.05\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true\n\t\tthis.zoomSpeed = 1.0\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true\n\t\tthis.rotateSpeed = 1.0\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true\n\t\tthis.panSpeed = 1.0\n\t\tthis.screenSpacePanning = true // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0 // pixels moved per arrow key push\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false\n\t\tthis.autoRotateSpeed = 2.0 // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = {\n\t\t\tLEFT: 'ArrowLeft',\n\t\t\tUP: 'ArrowUp',\n\t\t\tRIGHT: 'ArrowRight',\n\t\t\tBOTTOM: 'ArrowDown'\n\t\t}\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = {\n\t\t\tLEFT: MOUSE.ROTATE,\n\t\t\tMIDDLE: MOUSE.DOLLY,\n\t\t\tRIGHT: MOUSE.PAN\n\t\t}\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN }\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone()\n\t\tthis.position0 = this.camera.position.clone()\n\t\tthis.zoom0 = this.camera.zoom\n\n\t\t// the target DOM element for key events\n\t\tthis.domElementKeyEvents = null\n\n\t\t//\n\t\t// public methods\n\t\t//\n\n\t\tthis.getPolarAngle = (): number => {\n\t\t\treturn spherical.phi\n\t\t}\n\n\t\tthis.getAzimuthalAngle = (): number => {\n\t\t\treturn spherical.theta\n\t\t}\n\n\t\tthis.listenToKeyEvents = (domElement: HTMLElement) => {\n\t\t\tdomElement.addEventListener('keydown', onKeyDown)\n\t\t\tthis.domElementKeyEvents = domElement\n\t\t}\n\n\t\tthis.saveState = (): void => {\n\t\t\tscope.target0.copy(scope.target)\n\t\t\tscope.position0.copy(scope.camera.position)\n\t\t\tscope.zoom0 = scope.camera.zoom\n\t\t}\n\n\t\tthis.reset = (): void => {\n\t\t\tscope.target.copy(scope.target0)\n\t\t\tscope.camera.position.copy(scope.position0)\n\t\t\tscope.camera.zoom = scope.zoom0\n\n\t\t\tscope.camera.updateProjectionMatrix()\n\t\t\tscope.dispatchEvent(changeEvent)\n\n\t\t\tscope.update()\n\n\t\t\tstate = STATE.NONE\n\t\t}\n\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\n\t\tthis.update = ((): (() => boolean) => {\n\t\t\tconst offset = new Vector3()\n\n\t\t\t// so camera.up is the orbit axis\n\t\t\tconst quat = new Quaternion().setFromUnitVectors(camera.up, new Vector3(0, 1, 0))\n\t\t\tconst quatInverse = quat.clone().invert()\n\n\t\t\tconst lastPosition = new Vector3()\n\t\t\tconst lastQuaternion = new Quaternion()\n\n\t\t\tconst twoPI = 2 * Math.PI\n\n\t\t\treturn (): boolean => {\n\t\t\t\tconst { position } = scope.camera\n\n\t\t\t\toffset.copy(position).sub(scope.target)\n\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t\t\toffset.applyQuaternion(quat)\n\n\t\t\t\t// angle from z-axis around y-axis\n\t\t\t\tspherical.setFromVector3(offset)\n\n\t\t\t\tif (scope.autoRotate && state === STATE.NONE) {\n\t\t\t\t\trotateLeft(getAutoRotationAngle())\n\t\t\t\t}\n\n\t\t\t\tif (scope.enableDamping) {\n\t\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor\n\t\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor\n\t\t\t\t} else {\n\t\t\t\t\tspherical.theta += sphericalDelta.theta\n\t\t\t\t\tspherical.phi += sphericalDelta.phi\n\t\t\t\t}\n\n\t\t\t\t// restrict theta to be between desired limits\n\n\t\t\t\tlet min = scope.minAzimuthAngle\n\t\t\t\tlet max = scope.maxAzimuthAngle\n\n\t\t\t\tif (Number.isFinite(min) && Number.isFinite(max)) {\n\t\t\t\t\tif (min < -Math.PI) min += twoPI\n\t\t\t\t\telse if (min > Math.PI) min -= twoPI\n\n\t\t\t\t\tif (max < -Math.PI) max += twoPI\n\t\t\t\t\telse if (max > Math.PI) max -= twoPI\n\n\t\t\t\t\tif (min <= max) {\n\t\t\t\t\t\tspherical.theta = Math.max(min, Math.min(max, spherical.theta))\n\t\t\t\t\t} else {\n\t\t\t\t\t\tspherical.theta = spherical.theta > (min + max) / 2 ? Math.max(min, spherical.theta) : Math.min(max, spherical.theta)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// restrict phi to be between desired limits\n\t\t\t\tspherical.phi = Math.max(scope.minPolarAngle, Math.min(scope.maxPolarAngle, spherical.phi))\n\n\t\t\t\tspherical.makeSafe()\n\n\t\t\t\tspherical.radius *= scale\n\n\t\t\t\t// restrict radius to be between desired limits\n\t\t\t\tspherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius))\n\n\t\t\t\t// move target to panned location\n\n\t\t\t\tif (scope.enableDamping === true) {\n\t\t\t\t\tscope.target.addScaledVector(panOffset, scope.dampingFactor)\n\t\t\t\t} else {\n\t\t\t\t\tscope.target.add(panOffset)\n\t\t\t\t}\n\n\t\t\t\toffset.setFromSpherical(spherical)\n\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t\t\toffset.applyQuaternion(quatInverse)\n\n\t\t\t\tposition.copy(scope.target).add(offset)\n\n\t\t\t\tscope.camera.lookAt(scope.target)\n\n\t\t\t\tif (scope.enableDamping === true) {\n\t\t\t\t\tsphericalDelta.theta *= 1 - scope.dampingFactor\n\t\t\t\t\tsphericalDelta.phi *= 1 - scope.dampingFactor\n\n\t\t\t\t\tpanOffset.multiplyScalar(1 - scope.dampingFactor)\n\t\t\t\t} else {\n\t\t\t\t\tsphericalDelta.set(0, 0, 0)\n\n\t\t\t\t\tpanOffset.set(0, 0, 0)\n\t\t\t\t}\n\n\t\t\t\tscale = 1\n\n\t\t\t\t// update condition is:\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\t\t\tif (zoomChanged || lastPosition.distanceToSquared(scope.camera.position) > EPS || 8 * (1 - lastQuaternion.dot(scope.camera.quaternion)) > EPS) {\n\t\t\t\t\tscope.dispatchEvent(changeEvent)\n\n\t\t\t\t\tlastPosition.copy(scope.camera.position)\n\t\t\t\t\tlastQuaternion.copy(scope.camera.quaternion)\n\t\t\t\t\tzoomChanged = false\n\n\t\t\t\t\treturn true\n\t\t\t\t}\n\n\t\t\t\treturn false\n\t\t\t}\n\t\t})()\n\n\t\tthis.dispose = (): void => {\n\t\t\tscope.domElement.removeEventListener('contextmenu', onContextMenu)\n\n\t\t\tscope.domElement.removeEventListener('pointerdown', onPointerDown)\n\t\t\tscope.domElement.removeEventListener('wheel', onMouseWheel)\n\n\t\t\tscope.domElement.removeEventListener('touchstart', onTouchStart)\n\t\t\tscope.domElement.removeEventListener('touchend', onTouchEnd)\n\t\t\tscope.domElement.removeEventListener('touchmove', onTouchMove)\n\n\t\t\tscope.domElement.ownerDocument.removeEventListener('pointermove', onPointerMove)\n\t\t\tscope.domElement.ownerDocument.removeEventListener('pointerup', onPointerUp)\n\n\t\t\tif (scope.domElementKeyEvents !== null) {\n\t\t\t\t// eslint-disable-next-line no-underscore-dangle\n\t\t\t\tscope.domElementKeyEvents.removeEventListener('keydown', onKeyDown)\n\t\t\t}\n\n\t\t\t// scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\n\t\t}\n\n\t\t//\n\t\t// internals\n\t\t//\n\n\t\tconst scope = this\n\n\t\tconst STATE = {\n\t\t\tNONE: -1,\n\t\t\tROTATE: 0,\n\t\t\tDOLLY: 1,\n\t\t\tPAN: 2,\n\t\t\tTOUCH_ROTATE: 3,\n\t\t\tTOUCH_PAN: 4,\n\t\t\tTOUCH_DOLLY_PAN: 5,\n\t\t\tTOUCH_DOLLY_ROTATE: 6\n\t\t}\n\n\t\tlet state = STATE.NONE\n\n\t\tconst EPS = 0.000001\n\n\t\t// current position in spherical coordinates\n\t\tconst spherical = new Spherical()\n\t\tconst sphericalDelta = new Spherical()\n\n\t\tlet scale = 1\n\t\tconst panOffset = new Vector3()\n\t\tlet zoomChanged = false\n\n\t\tconst rotateStart = new Vector2()\n\t\tconst rotateEnd = new Vector2()\n\t\tconst rotateDelta = new Vector2()\n\n\t\tconst panStart = new Vector2()\n\t\tconst panEnd = new Vector2()\n\t\tconst panDelta = new Vector2()\n\n\t\tconst dollyStart = new Vector2()\n\t\tconst dollyEnd = new Vector2()\n\t\tconst dollyDelta = new Vector2()\n\n\t\tfunction getAutoRotationAngle(): number {\n\t\t\treturn ((2 * Math.PI) / 60 / 60) * scope.autoRotateSpeed\n\t\t}\n\n\t\tfunction getZoomScale(): number {\n\t\t\treturn Math.pow(0.95, scope.zoomSpeed)\n\t\t}\n\n\t\tfunction rotateLeft(angle: number): void {\n\t\t\tsphericalDelta.theta -= angle\n\t\t}\n\n\t\tfunction rotateUp(angle: number): void {\n\t\t\tsphericalDelta.phi -= angle\n\t\t}\n\n\t\tconst panLeft = (() => {\n\t\t\tconst v = new Vector3()\n\n\t\t\treturn function panLeft(distance: number, objectMatrix: Matrix4) {\n\t\t\t\tv.setFromMatrixColumn(objectMatrix, 0) // get X column of objectMatrix\n\t\t\t\tv.multiplyScalar(-distance)\n\n\t\t\t\tpanOffset.add(v)\n\t\t\t}\n\t\t})()\n\n\t\tconst panUp = (() => {\n\t\t\tconst v = new Vector3()\n\n\t\t\treturn function panUp(distance: number, objectMatrix: Matrix4) {\n\t\t\t\tif (scope.screenSpacePanning === true) {\n\t\t\t\t\tv.setFromMatrixColumn(objectMatrix, 1)\n\t\t\t\t} else {\n\t\t\t\t\tv.setFromMatrixColumn(objectMatrix, 0)\n\t\t\t\t\tv.crossVectors(scope.camera.up, v)\n\t\t\t\t}\n\n\t\t\t\tv.multiplyScalar(distance)\n\n\t\t\t\tpanOffset.add(v)\n\t\t\t}\n\t\t})()\n\n\t\t// deltaX and deltaY are in pixels; right and down are positive\n\t\tconst pan = (() => {\n\t\t\tconst offset = new Vector3()\n\n\t\t\treturn function pan(deltaX: number, deltaY: number) {\n\t\t\t\tconst element = scope.domElement\n\n\t\t\t\tif (scope.camera.isPerspectiveCamera) {\n\t\t\t\t\t// perspective\n\t\t\t\t\tconst { position } = scope.camera\n\t\t\t\t\toffset.copy(position).sub(scope.target)\n\t\t\t\t\tlet targetDistance = offset.length()\n\n\t\t\t\t\t// half of the fov is center to top of screen\n\t\t\t\t\ttargetDistance *= Math.tan(((scope.camera.fov / 2) * Math.PI) / 180.0)\n\n\t\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\t\t\tpanLeft((2 * deltaX * targetDistance) / element.clientHeight, scope.camera.matrix)\n\t\t\t\t\tpanUp((2 * deltaY * targetDistance) / element.clientHeight, scope.camera.matrix)\n\t\t\t\t}\n\t\t\t\t// else if (scope.camera.isOrthographicCamera) {\n\t\t\t\t// \t// isOrthographicCamera\n\t\t\t\t// \t// orthographic\n\t\t\t\t// \tpanLeft((deltaX * (scope.camera.right - scope.camera.left)) / scope.camera.zoom / element.clientWidth, scope.camera.matrix)\n\t\t\t\t// \tpanUp((deltaY * (scope.camera.top - scope.camera.bottom)) / scope.camera.zoom / element.clientHeight, scope.camera.matrix)\n\t\t\t\t// }\n\t\t\t\telse {\n\t\t\t\t\t// camera neither orthographic nor perspective\n\t\t\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.')\n\t\t\t\t\tscope.enablePan = false\n\t\t\t\t}\n\t\t\t}\n\t\t})()\n\n\t\tfunction dollyOut(dollyScale: number): void {\n\t\t\tif (scope.camera.isPerspectiveCamera) {\n\t\t\t\tscale /= dollyScale\n\t\t\t}\n\t\t\t//  else if (scope.camera.isOrthographicCamera) {\n\t\t\t// \tscope.camera.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.camera.zoom * dollyScale))\n\t\t\t// \tscope.camera.updateProjectionMatrix()\n\t\t\t// \tzoomChanged = true\n\t\t\t// }\n\t\t\telse {\n\t\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.')\n\t\t\t\tscope.enableZoom = false\n\t\t\t}\n\t\t}\n\n\t\tfunction dollyIn(dollyScale: number): void {\n\t\t\tif (scope.camera.isPerspectiveCamera) {\n\t\t\t\tscale *= dollyScale\n\t\t\t}\n\t\t\t// else if (scope.camera.isOrthographicCamera) {\n\t\t\t// \tscope.camera.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.camera.zoom / dollyScale))\n\t\t\t// \tscope.camera.updateProjectionMatrix()\n\t\t\t// \tzoomChanged = true\n\t\t\t// }\n\t\t\telse {\n\t\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.')\n\t\t\t\tscope.enableZoom = false\n\t\t\t}\n\t\t}\n\n\t\t//\n\t\t// event callbacks - update the object state\n\t\t//\n\n\t\tfunction handleMouseDownRotate(event: { clientX: number; clientY: number }): void {\n\t\t\trotateStart.set(event.clientX, event.clientY)\n\t\t}\n\n\t\tfunction handleMouseDownDolly(event: { clientX: number; clientY: number }): void {\n\t\t\tdollyStart.set(event.clientX, event.clientY)\n\t\t}\n\n\t\tfunction handleMouseDownPan(event: { clientX: number; clientY: number }): void {\n\t\t\tpanStart.set(event.clientX, event.clientY)\n\t\t}\n\n\t\tfunction handleMouseMoveRotate(event: { clientX: number; clientY: number }): void {\n\t\t\trotateEnd.set(event.clientX, event.clientY)\n\n\t\t\trotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed)\n\n\t\t\tconst element = scope.domElement\n\n\t\t\trotateLeft((2 * Math.PI * rotateDelta.x) / element.clientHeight) // yes, height\n\n\t\t\trotateUp((2 * Math.PI * rotateDelta.y) / element.clientHeight)\n\n\t\t\trotateStart.copy(rotateEnd)\n\n\t\t\tscope.update()\n\t\t}\n\n\t\tfunction handleMouseMoveDolly(event: { clientX: number; clientY: number }): void {\n\t\t\tdollyEnd.set(event.clientX, event.clientY)\n\n\t\t\tdollyDelta.subVectors(dollyEnd, dollyStart)\n\n\t\t\tif (dollyDelta.y > 0) {\n\t\t\t\tdollyOut(getZoomScale())\n\t\t\t} else if (dollyDelta.y < 0) {\n\t\t\t\tdollyIn(getZoomScale())\n\t\t\t}\n\n\t\t\tdollyStart.copy(dollyEnd)\n\n\t\t\tscope.update()\n\t\t}\n\n\t\tfunction handleMouseMovePan(event: { clientX: number; clientY: number }): void {\n\t\t\tpanEnd.set(event.clientX, event.clientY)\n\n\t\t\tpanDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed)\n\n\t\t\tpan(panDelta.x, panDelta.y)\n\n\t\t\tpanStart.copy(panEnd)\n\n\t\t\tscope.update()\n\t\t}\n\n\t\tfunction handleMouseUp(event: MouseEvent): void {\n\t\t\t// no-op\n\t\t}\n\n\t\tfunction handleMouseWheel(event: { deltaY: number }): void {\n\t\t\tif (event.deltaY < 0) {\n\t\t\t\tdollyIn(getZoomScale())\n\t\t\t} else if (event.deltaY > 0) {\n\t\t\t\tdollyOut(getZoomScale())\n\t\t\t}\n\n\t\t\tscope.update()\n\t\t}\n\n\t\tfunction handleKeyDown(event: KeyboardEvent): void {\n\t\t\tlet needsUpdate = false\n\n\t\t\tswitch (event.code) {\n\t\t\t\tcase scope.keys.UP:\n\t\t\t\t\tpan(0, scope.keyPanSpeed)\n\t\t\t\t\tneedsUpdate = true\n\t\t\t\t\tbreak\n\n\t\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\t\tpan(0, -scope.keyPanSpeed)\n\t\t\t\t\tneedsUpdate = true\n\t\t\t\t\tbreak\n\n\t\t\t\tcase scope.keys.LEFT:\n\t\t\t\t\tpan(scope.keyPanSpeed, 0)\n\t\t\t\t\tneedsUpdate = true\n\t\t\t\t\tbreak\n\n\t\t\t\tcase scope.keys.RIGHT:\n\t\t\t\t\tpan(-scope.keyPanSpeed, 0)\n\t\t\t\t\tneedsUpdate = true\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t}\n\n\t\t\tif (needsUpdate) {\n\t\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\t\tevent.preventDefault()\n\n\t\t\t\tscope.update()\n\t\t\t}\n\t\t}\n\n\t\tfunction handleTouchStartRotate(event: TouchEvent): void {\n\t\t\tif (event.touches.length === 1) {\n\t\t\t\trotateStart.set(event.touches[0].pageX, event.touches[0].pageY)\n\t\t\t} else {\n\t\t\t\tconst x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX)\n\t\t\t\tconst y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY)\n\n\t\t\t\trotateStart.set(x, y)\n\t\t\t}\n\t\t}\n\n\t\tfunction handleTouchStartPan(event: TouchEvent): void {\n\t\t\tif (event.touches.length === 1) {\n\t\t\t\tpanStart.set(event.touches[0].pageX, event.touches[0].pageY)\n\t\t\t} else {\n\t\t\t\tconst x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX)\n\t\t\t\tconst y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY)\n\n\t\t\t\tpanStart.set(x, y)\n\t\t\t}\n\t\t}\n\n\t\tfunction handleTouchStartDolly(event: TouchEvent): void {\n\t\t\tconst dx = event.touches[0].pageX - event.touches[1].pageX\n\t\t\tconst dy = event.touches[0].pageY - event.touches[1].pageY\n\n\t\t\tconst distance = Math.sqrt(dx * dx + dy * dy)\n\n\t\t\tdollyStart.set(0, distance)\n\t\t}\n\n\t\tfunction handleTouchStartDollyPan(event: TouchEvent): void {\n\t\t\tif (scope.enableZoom) handleTouchStartDolly(event)\n\n\t\t\tif (scope.enablePan) handleTouchStartPan(event)\n\t\t}\n\n\t\tfunction handleTouchStartDollyRotate(event: TouchEvent): void {\n\t\t\tif (scope.enableZoom) handleTouchStartDolly(event)\n\n\t\t\tif (scope.enableRotate) handleTouchStartRotate(event)\n\t\t}\n\n\t\tfunction handleTouchMoveRotate(event: TouchEvent): void {\n\t\t\tif (event.touches.length === 1) {\n\t\t\t\trotateEnd.set(event.touches[0].pageX, event.touches[0].pageY)\n\t\t\t} else {\n\t\t\t\tconst x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX)\n\t\t\t\tconst y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY)\n\n\t\t\t\trotateEnd.set(x, y)\n\t\t\t}\n\n\t\t\trotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed)\n\n\t\t\tconst element = scope.domElement\n\n\t\t\trotateLeft((2 * Math.PI * rotateDelta.x) / element.clientHeight) // yes, height\n\n\t\t\trotateUp((2 * Math.PI * rotateDelta.y) / element.clientHeight)\n\n\t\t\trotateStart.copy(rotateEnd)\n\t\t}\n\n\t\tfunction handleTouchMovePan(event: TouchEvent): void {\n\t\t\tif (event.touches.length === 1) {\n\t\t\t\tpanEnd.set(event.touches[0].pageX, event.touches[0].pageY)\n\t\t\t} else {\n\t\t\t\tconst x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX)\n\t\t\t\tconst y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY)\n\n\t\t\t\tpanEnd.set(x, y)\n\t\t\t}\n\n\t\t\tpanDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed)\n\n\t\t\tpan(panDelta.x, panDelta.y)\n\n\t\t\tpanStart.copy(panEnd)\n\t\t}\n\n\t\tfunction handleTouchMoveDolly(event: TouchEvent): void {\n\t\t\tconst dx = event.touches[0].pageX - event.touches[1].pageX\n\t\t\tconst dy = event.touches[0].pageY - event.touches[1].pageY\n\n\t\t\tconst distance = Math.sqrt(dx * dx + dy * dy)\n\n\t\t\tdollyEnd.set(0, distance)\n\n\t\t\tdollyDelta.set(0, Math.pow(dollyEnd.y / dollyStart.y, scope.zoomSpeed))\n\n\t\t\tdollyOut(dollyDelta.y)\n\n\t\t\tdollyStart.copy(dollyEnd)\n\t\t}\n\n\t\tfunction handleTouchMoveDollyPan(event: TouchEvent): void {\n\t\t\tif (scope.enableZoom) handleTouchMoveDolly(event)\n\n\t\t\tif (scope.enablePan) handleTouchMovePan(event)\n\t\t}\n\n\t\tfunction handleTouchMoveDollyRotate(event: TouchEvent): void {\n\t\t\tif (scope.enableZoom) handleTouchMoveDolly(event)\n\n\t\t\tif (scope.enableRotate) handleTouchMoveRotate(event)\n\t\t}\n\n\t\tfunction handleTouchEnd(event: TouchEvent): void {\n\t\t\t// no-op\n\t\t}\n\n\t\t//\n\t\t// event handlers - FSM: listen for events and reset state\n\t\t//\n\n\t\tfunction onPointerDown(event: PointerEvent): void {\n\t\t\tif (scope.enabled === false) return\n\n\t\t\tswitch (event.pointerType) {\n\t\t\t\tcase 'mouse':\n\t\t\t\tcase 'pen':\n\t\t\t\t\tonMouseDown(event)\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t\t// TODO touch\n\t\t\t}\n\t\t}\n\n\t\tfunction onPointerMove(event: PointerEvent): void {\n\t\t\tif (scope.enabled === false) return\n\n\t\t\tswitch (event.pointerType) {\n\t\t\t\tcase 'mouse':\n\t\t\t\tcase 'pen':\n\t\t\t\t\tonMouseMove(event)\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t\t// TODO touch\n\t\t\t}\n\t\t}\n\n\t\tfunction onPointerUp(event: PointerEvent): void {\n\t\t\tswitch (event.pointerType) {\n\t\t\t\tcase 'mouse':\n\t\t\t\tcase 'pen':\n\t\t\t\t\tonMouseUp(event)\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\n\t\t\t\t// TODO touch\n\t\t\t}\n\t\t}\n\n\t\tfunction onMouseDown(event: MouseEvent): void {\n\t\t\t// Prevent the browser from scrolling.\n\t\t\tevent.preventDefault()\n\n\t\t\t// Manually set the focus since calling preventDefault above\n\t\t\t// prevents the browser from setting it automatically.\n\n\t\t\tif (scope.domElement.focus) {\n\t\t\t\tscope.domElement.focus()\n\t\t\t} else {\n\t\t\t\twindow.focus()\n\t\t\t}\n\n\t\t\tlet mouseAction\n\n\t\t\tswitch (event.button) {\n\t\t\t\tcase 0:\n\t\t\t\t\tmouseAction = scope.mouseButtons.LEFT\n\t\t\t\t\tbreak\n\n\t\t\t\tcase 1:\n\t\t\t\t\tmouseAction = scope.mouseButtons.MIDDLE\n\t\t\t\t\tbreak\n\n\t\t\t\tcase 2:\n\t\t\t\t\tmouseAction = scope.mouseButtons.RIGHT\n\t\t\t\t\tbreak\n\n\t\t\t\tdefault:\n\t\t\t\t\tmouseAction = -1\n\t\t\t}\n\n\t\t\tswitch (mouseAction) {\n\t\t\t\tcase MOUSE.DOLLY:\n\t\t\t\t\tif (scope.enableZoom === false) return\n\n\t\t\t\t\thandleMouseDownDolly(event)\n\n\t\t\t\t\tstate = STATE.DOLLY\n\n\t\t\t\t\tbreak\n\n\t\t\t\tcase MOUSE.ROTATE:\n\t\t\t\t\tif (event.ctrlKey || event.metaKey || event.shiftKey) {\n\t\t\t\t\t\tif (scope.enablePan === false) return\n\n\t\t\t\t\t\thandleMouseDownPan(event)\n\n\t\t\t\t\t\tstate = STATE.PAN\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (scope.enableRotate === false) return\n\n\t\t\t\t\t\thandleMouseDownRotate(event)\n\n\t\t\t\t\t\tstate = STATE.ROTATE\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak\n\n\t\t\t\tcase MOUSE.PAN:\n\t\t\t\t\tif (event.ctrlKey || event.metaKey || event.shiftKey) {\n\t\t\t\t\t\tif (scope.enableRotate === false) return\n\n\t\t\t\t\t\thandleMouseDownRotate(event)\n\n\t\t\t\t\t\tstate = STATE.ROTATE\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (scope.enablePan === false) return\n\n\t\t\t\t\t\thandleMouseDownPan(event)\n\n\t\t\t\t\t\tstate = STATE.PAN\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak\n\n\t\t\t\tdefault:\n\t\t\t\t\tstate = STATE.NONE\n\t\t\t}\n\n\t\t\tif (state !== STATE.NONE) {\n\t\t\t\tscope.domElement.ownerDocument.addEventListener('pointermove', onPointerMove)\n\t\t\t\tscope.domElement.ownerDocument.addEventListener('pointerup', onPointerUp)\n\n\t\t\t\tscope.dispatchEvent(startEvent)\n\t\t\t}\n\t\t}\n\n\t\tfunction onMouseMove(event: MouseEvent): void {\n\t\t\tif (scope.enabled === false) return\n\n\t\t\tevent.preventDefault()\n\n\t\t\tswitch (state) {\n\t\t\t\tcase STATE.ROTATE:\n\t\t\t\t\tif (scope.enableRotate === false) return\n\n\t\t\t\t\thandleMouseMoveRotate(event)\n\n\t\t\t\t\tbreak\n\n\t\t\t\tcase STATE.DOLLY:\n\t\t\t\t\tif (scope.enableZoom === false) return\n\n\t\t\t\t\thandleMouseMoveDolly(event)\n\n\t\t\t\t\tbreak\n\n\t\t\t\tcase STATE.PAN:\n\t\t\t\t\tif (scope.enablePan === false) return\n\n\t\t\t\t\thandleMouseMovePan(event)\n\n\t\t\t\t\tbreak\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tfunction onMouseUp(event: MouseEvent): void {\n\t\t\tscope.domElement.ownerDocument.removeEventListener('pointermove', onPointerMove)\n\t\t\tscope.domElement.ownerDocument.removeEventListener('pointerup', onPointerUp)\n\n\t\t\tif (scope.enabled === false) return\n\n\t\t\thandleMouseUp(event)\n\n\t\t\tscope.dispatchEvent(endEvent)\n\n\t\t\tstate = STATE.NONE\n\t\t}\n\n\t\tfunction onMouseWheel(event: WheelEvent): void {\n\t\t\tif (scope.enabled === false || scope.enableZoom === false || (state !== STATE.NONE && state !== STATE.ROTATE)) return\n\n\t\t\tevent.preventDefault()\n\n\t\t\tscope.dispatchEvent(startEvent)\n\n\t\t\thandleMouseWheel(event)\n\n\t\t\tscope.dispatchEvent(endEvent)\n\t\t}\n\n\t\tfunction onKeyDown(event: KeyboardEvent): void {\n\t\t\tif (scope.enabled === false || scope.enablePan === false) return\n\n\t\t\thandleKeyDown(event)\n\t\t}\n\n\t\tfunction onTouchStart(event: TouchEvent): void {\n\t\t\tif (scope.enabled === false) return\n\n\t\t\tevent.preventDefault() // prevent scrolling\n\n\t\t\tswitch (event.touches.length) {\n\t\t\t\tcase 1:\n\t\t\t\t\tswitch (scope.touches.ONE) {\n\t\t\t\t\t\tcase TOUCH.ROTATE:\n\t\t\t\t\t\t\tif (scope.enableRotate === false) return\n\n\t\t\t\t\t\t\thandleTouchStartRotate(event)\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE\n\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase TOUCH.PAN:\n\t\t\t\t\t\t\tif (scope.enablePan === false) return\n\n\t\t\t\t\t\t\thandleTouchStartPan(event)\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_PAN\n\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstate = STATE.NONE\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak\n\n\t\t\t\tcase 2:\n\t\t\t\t\tswitch (scope.touches.TWO) {\n\t\t\t\t\t\tcase TOUCH.DOLLY_PAN:\n\t\t\t\t\t\t\tif (scope.enableZoom === false && scope.enablePan === false) return\n\n\t\t\t\t\t\t\thandleTouchStartDollyPan(event)\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN\n\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\t\t\t\t\t\t\tif (scope.enableZoom === false && scope.enableRotate === false) return\n\n\t\t\t\t\t\t\thandleTouchStartDollyRotate(event)\n\n\t\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE\n\n\t\t\t\t\t\t\tbreak\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tstate = STATE.NONE\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak\n\n\t\t\t\tdefault:\n\t\t\t\t\tstate = STATE.NONE\n\t\t\t}\n\n\t\t\tif (state !== STATE.NONE) {\n\t\t\t\tscope.dispatchEvent(startEvent)\n\t\t\t}\n\t\t}\n\n\t\tfunction onTouchMove(event: TouchEvent): void {\n\t\t\tif (scope.enabled === false) return\n\n\t\t\tevent.preventDefault() // prevent scrolling\n\n\t\t\tswitch (state) {\n\t\t\t\tcase STATE.TOUCH_ROTATE:\n\t\t\t\t\tif (scope.enableRotate === false) return\n\n\t\t\t\t\thandleTouchMoveRotate(event)\n\n\t\t\t\t\tscope.update()\n\n\t\t\t\t\tbreak\n\n\t\t\t\tcase STATE.TOUCH_PAN:\n\t\t\t\t\tif (scope.enablePan === false) return\n\n\t\t\t\t\thandleTouchMovePan(event)\n\n\t\t\t\t\tscope.update()\n\n\t\t\t\t\tbreak\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_PAN:\n\t\t\t\t\tif (scope.enableZoom === false && scope.enablePan === false) return\n\n\t\t\t\t\thandleTouchMoveDollyPan(event)\n\n\t\t\t\t\tscope.update()\n\n\t\t\t\t\tbreak\n\n\t\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\n\t\t\t\t\tif (scope.enableZoom === false && scope.enableRotate === false) return\n\n\t\t\t\t\thandleTouchMoveDollyRotate(event)\n\n\t\t\t\t\tscope.update()\n\n\t\t\t\t\tbreak\n\n\t\t\t\tdefault:\n\t\t\t\t\tstate = STATE.NONE\n\t\t\t}\n\t\t}\n\n\t\tfunction onTouchEnd(event: TouchEvent): void {\n\t\t\tif (scope.enabled === false) return\n\n\t\t\thandleTouchEnd(event)\n\n\t\t\tscope.dispatchEvent(endEvent)\n\n\t\t\tstate = STATE.NONE\n\t\t}\n\n\t\tfunction onContextMenu(event: MouseEvent): void {\n\t\t\tif (scope.enabled === false) return\n\n\t\t\tevent.preventDefault()\n\t\t}\n\n\t\t//\n\n\t\tscope.domElement.addEventListener('contextmenu', onContextMenu)\n\n\t\tscope.domElement.addEventListener('pointerdown', onPointerDown)\n\t\tscope.domElement.addEventListener('wheel', onMouseWheel, {\n\t\t\tpassive: false\n\t\t})\n\n\t\tscope.domElement.addEventListener('touchstart', onTouchStart, {\n\t\t\tpassive: false\n\t\t})\n\t\tscope.domElement.addEventListener('touchend', onTouchEnd)\n\t\tscope.domElement.addEventListener('touchmove', onTouchMove, {\n\t\t\tpassive: false\n\t\t})\n\n\t\t// force an update at start\n\n\t\tthis.update()\n\t}\n}\n\nexport default CameraOrbitControls\n","import { MOUSE, PerspectiveCamera, TOUCH } from 'three'\nimport CameraOrbitControls from './cameraOrbitControls'\n\nclass CameraMapControls extends CameraOrbitControls {\n\tconstructor(camera: PerspectiveCamera, domElement: HTMLElement) {\n\t\tsuper(camera, domElement)\n\n\t\tthis.screenSpacePanning = false // pan orthogonal to world-space direction camera.up\n\n\t\tthis.mouseButtons.LEFT = MOUSE.PAN\n\t\tthis.mouseButtons.RIGHT = MOUSE.ROTATE\n\n\t\tthis.touches.ONE = TOUCH.PAN\n\t\tthis.touches.TWO = TOUCH.DOLLY_ROTATE\n\t}\n}\nexport default CameraMapControls\n","import { PerspectiveCamera, Raycaster, Vector2 } from 'three'\nimport { ICordinates } from '../gameObjects/gameObjectWorldData'\nimport GameWorld from '../gameWorld'\n\nclass WorldInteractionControls {\n\tprivate camera: PerspectiveCamera\n\n\tprivate container: HTMLElement\n\n\tprivate gameWorld: GameWorld\n\n\tconstructor(container: HTMLElement, camera: PerspectiveCamera, gameWorld: GameWorld) {\n\t\tthis.container = container\n\t\tthis.camera = camera\n\t\tthis.gameWorld = gameWorld\n\t}\n\n\tpublic initialize = (): void => {\n\t\tthis.container.addEventListener('click', this.handleClick, false)\n\t\tthis.container.addEventListener('contextmenu', this.handleClick, false)\n\t\tthis.container.addEventListener('mousemove', this.handleMouseMove, false)\n\t}\n\n\tgetMouseRaycaster = (event: MouseEvent): Raycaster => {\n\t\tconst raycaster = new Raycaster()\n\t\tconst mouse = new Vector2()\n\t\tmouse.x = (event.clientX / window.innerWidth) * 2 - 1\n\t\tmouse.y = -(event.clientY / window.innerHeight) * 2 + 1\n\n\t\traycaster.setFromCamera(mouse, this.camera)\n\t\treturn raycaster\n\t}\n\n\tprivate handleMouseMove = (event: MouseEvent): void => {\n\t\tevent.preventDefault()\n\t\tconst raycaster = this.getMouseRaycaster(event)\n\t\tconst intersecs = this.gameWorld.getGameObjectIntersection(raycaster)\n\t\tthis.gameWorld.hoverGameObject(intersecs)\n\t}\n\n\tprivate handleClick = (event: MouseEvent): void => {\n\t\tevent.preventDefault()\n\t\tif (event.button === 0) {\n\t\t\tthis.handleLeftClick(event)\n\t\t}\n\t\tif (event.button === 2) {\n\t\t\tthis.handleRightClick(event)\n\t\t}\n\t}\n\n\tprivate handleLeftClick = (event: MouseEvent): void => {\n\t\tconst raycaster = this.getMouseRaycaster(event)\n\t\tconst intersecs = this.gameWorld.getGameObjectIntersection(raycaster)\n\t\tthis.gameWorld.selectGameObject(intersecs, true)\n\t}\n\n\tprivate handleRightClick = (event: MouseEvent): void => {\n\t\tconst raycaster = this.getMouseRaycaster(event)\n\t\tconst intersecs = this.gameWorld.getSceneIntersection(raycaster)\n\t\tif (intersecs && intersecs.length > 0) {\n\t\t\tconst destination: ICordinates = {\n\t\t\t\tx: intersecs[0].point.x,\n\t\t\t\ty: intersecs[0].point.y,\n\t\t\t\tz: intersecs[0].point.z\n\t\t\t}\n\t\t\tthis.gameWorld.moveSelectedGameObjects(destination)\n\t\t}\n\t}\n}\n\nexport default WorldInteractionControls\n","import { PerspectiveCamera } from 'three'\nimport CameraMapControls from './cameraMapControls'\nimport WorldInteractionControls from './worldInteractionControls'\nimport GameWorld from '../gameWorld'\nimport { IUpdate } from '../gameRenderer'\n\nclass GameControls implements IUpdate {\n\tprivate cameraMapControls: CameraMapControls\n\n\tprivate worldInteractionControls: WorldInteractionControls\n\n\tconstructor(container: HTMLElement, camera: PerspectiveCamera, gameWorld: GameWorld) {\n\t\tthis.worldInteractionControls = new WorldInteractionControls(container, camera, gameWorld)\n\t\tthis.cameraMapControls = new CameraMapControls(camera, container)\n\t}\n\n\tpublic initialize = (): void => {\n\t\tthis.worldInteractionControls.initialize()\n\n\t\tthis.cameraMapControls.screenSpacePanning = false\n\t\tthis.cameraMapControls.minDistance = 5\n\t\tthis.cameraMapControls.maxDistance = 75\n\n\t\t// \"Math.PI\" = allow full bird view\n\t\t// \"Math.PI / 10\" = allow 10% angle from full bird view\n\t\tthis.cameraMapControls.minPolarAngle = Math.PI / 10\n\n\t\t// \"0\" = allow to look from bottom\n\t\t// \"Math.PI / 2.5\" = lowest look angle is 40%\n\t\tthis.cameraMapControls.maxPolarAngle = Math.PI / 2.5\n\n\t\tthis.cameraMapControls.target.set(0, 0, 0)\n\t\t// setInterval(() => this.cameraMapControls.update(), 5000)\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tpublic update = (timer: number, delta: number): void => {\n\t\tthis.cameraMapControls.update()\n\t}\n}\nexport default GameControls\n","import { Material, Mesh, Object3D } from 'three'\n\nclass Object3DHelper {\n\tpublic static cloneObject3D = (object: Object3D, recursive = true, cloneMaterials = false): Object3D => {\n\t\tconst newObject = object.clone(true)\n\t\tif (recursive) {\n\t\t\tnewObject.traverse((m) => {\n\t\t\t\tconst mesh = m as Mesh\n\t\t\t\tif (mesh.isMesh && cloneMaterials) {\n\t\t\t\t\tmesh.material = Object3DHelper.cloneMaterial(mesh.material)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn newObject\n\t}\n\n\tpublic static setShadows = (object: Object3D, castShadow = true, receiveShadow = true): Object3D => {\n\t\tobject.traverse((m) => {\n\t\t\tconst mesh = m as Mesh\n\t\t\tmesh.castShadow = castShadow\n\t\t\tmesh.receiveShadow = receiveShadow\n\t\t})\n\t\treturn object\n\t}\n\n\tpublic static cloneMaterial = (material: Material | Material[]): Material | Material[] => {\n\t\tlet newMaterial = material\n\t\tif (Array.isArray(newMaterial)) {\n\t\t\tnewMaterial = newMaterial.filter((im) => im.isMaterial).map((m) => m.clone())\n\t\t} else if (newMaterial.isMaterial) {\n\t\t\tnewMaterial = newMaterial.clone()\n\t\t}\n\t\treturn newMaterial\n\t}\n}\nexport default Object3DHelper\n","var _path, _path2, _path3;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgTowerIcon(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 512 512\",\n    xmlSpace: \"preserve\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M323.84 452.267c-5.12 0-8.533 3.413-8.533 8.533 0 5.12 3.413 8.533 8.533 8.533s8.533-3.413 8.533-8.533c0-5.12-3.413-8.533-8.533-8.533z\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M372.48 129.707 264.107 38.006V8.533c0-5.12-3.413-8.533-8.533-8.533-5.12 0-8.533 3.413-8.533 8.533v30.195l-107.52 90.978c-2.56 2.56-3.413 5.973-2.56 9.387s4.267 5.973 7.68 5.973h8.533v25.6c0 5.12 3.413 8.533 8.533 8.533h8.533v230.4h-8.533c-4.267 0-7.68 3.413-8.533 7.68l-8.533 85.333c0 2.56.853 5.12 2.56 6.827.853 1.707 3.413 2.56 5.973 2.56h204.8c2.56 0 5.12-.853 5.973-2.56 1.707-1.707 2.56-4.267 2.56-6.827l-8.533-85.333c-.853-4.267-4.267-7.68-8.533-7.68h-8.533V179.2h8.533c5.12 0 8.533-3.413 8.533-8.533v-25.6h8.533c3.413 0 6.827-2.56 8.533-5.973.853-3.414 0-6.827-2.56-9.387zM255.573 53.76l87.04 74.24H167.68l87.893-74.24zm93.014 441.173H162.56l6.827-68.267h172.374l6.826 68.267zm-24.747-204.8h-17.067c-5.12 0-8.533 3.413-8.533 8.533s3.413 8.533 8.533 8.533h17.067v102.4H187.307V384h17.067c5.12 0 8.533-3.413 8.533-8.533s-3.413-8.533-8.533-8.533h-17.067V221.867h17.067c5.12 0 8.533-3.413 8.533-8.533 0-5.12-3.413-8.533-8.533-8.533h-17.067v-25.6H323.84v110.932zm17.067-128H170.241v-17.067h170.667v17.067z\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M289.707 452.267h-51.2c-5.12 0-8.533 3.413-8.533 8.533 0 5.12 3.413 8.533 8.533 8.533h51.2c5.12 0 8.533-3.413 8.533-8.533 0-5.12-3.413-8.533-8.533-8.533zM204.373 452.267h-17.067c-5.12 0-8.533 3.413-8.533 8.533 0 5.12 3.413 8.533 8.533 8.533h17.067c5.12 0 8.533-3.413 8.533-8.533.001-5.12-3.413-8.533-8.533-8.533zM238.507 281.6h34.133c5.12 0 8.533-3.413 8.533-8.533V230.4c0-14.507-11.093-25.6-25.6-25.6-14.507 0-25.6 11.093-25.6 25.6v42.667c0 5.12 3.414 8.533 8.534 8.533zm8.533-51.2c0-5.12 3.413-8.533 8.533-8.533 5.12 0 8.533 3.413 8.533 8.533v34.133H247.04V230.4zM238.507 384h34.133c5.12 0 8.533-3.413 8.533-8.533V332.8c0-14.507-11.093-25.6-25.6-25.6-14.507 0-25.6 11.093-25.6 25.6v42.667c0 5.12 3.414 8.533 8.534 8.533zm8.533-51.2c0-5.12 3.413-8.533 8.533-8.533 5.12 0 8.533 3.413 8.533 8.533v34.133H247.04V332.8z\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgTowerIcon);\nexport default __webpack_public_path__ + \"static/media/tower-icon.5d90a352.svg\";\nexport { ForwardRef as ReactComponent };","import { PerspectiveCamera, Scene } from 'three'\nimport ModelLoader, { LoadedModels } from './loaders/modelLoader'\nimport { IGameObject } from './gameObjects/gameObject'\nimport MoveableGameObject from './gameObjects/moveableGameObject'\nimport GameStateDataService from './services/gameStateDataService'\nimport { CreateUnitResponse, SetUnitMessage } from './services/models'\nimport GameWorld from './gameWorld'\nimport GameRenderer from './gameRenderer'\nimport GameControls from './controls/gameControls'\nimport Object3DHelper from './helpers/object3dHelper'\n\nclass Game {\n\tprivate scene: Scene\n\n\tprivate camera: PerspectiveCamera\n\n\tprivate gameRenderer: GameRenderer\n\n\tprivate gameControls: GameControls\n\n\tprivate modelLoader: ModelLoader\n\n\tprivate gameWorld: GameWorld\n\n\tprivate gameStateDataService: GameStateDataService\n\n\tconstructor(container: HTMLDivElement) {\n\t\tthis.scene = new Scene()\n\t\tthis.camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 200)\n\n\t\tthis.gameWorld = new GameWorld(this.scene)\n\t\tthis.gameRenderer = new GameRenderer(container, this.scene, this.camera)\n\t\tthis.gameControls = new GameControls(container, this.camera, this.gameWorld)\n\t\tthis.modelLoader = new ModelLoader('assets/models/')\n\t\tthis.gameStateDataService = new GameStateDataService()\n\t}\n\n\tpublic initialize = (): void => {\n\t\tthis.gameRenderer.initialize()\n\t\tthis.gameControls.initialize()\n\t\tthis.modelLoader.initialize()\n\t\tthis.gameWorld.initialize()\n\n\t\tthis.gameRenderer.addUpdateTarget(this.gameWorld)\n\t\tthis.gameRenderer.addUpdateTarget(this.gameControls)\n\n\t\tthis.camera.position.set(30, 30, -20)\n\t\tthis.loadModels()\n\t}\n\n\tprivate connectToServer = (connectionAtempt = 0): void => {\n\t\tthis.gameStateDataService\n\t\t\t.connectToWebsocket(1)\n\t\t\t.then(() => this.handleConnectedToServer(true, connectionAtempt + 1))\n\t\t\t.catch(() => this.handleConnectedToServer(false, connectionAtempt + 1))\n\t}\n\n\tprivate handleConnectedToServer = (connected: boolean, connectionAtempt = 0): void => {\n\t\tif (connected) {\n\t\t\tthis.gameStateDataService.addMessageHandler('CreatUnit', this.handleServerCreateUnit)\n\t\t\tthis.gameStateDataService.addMessageHandler('SetUnit', this.handleServerSetUnit)\n\n\t\t\tthis.gameRenderer.start()\n\t\t} else {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.connectToServer(connectionAtempt)\n\t\t\t}, 5000 * connectionAtempt)\n\t\t}\n\t}\n\n\tprivate handleServerCreateUnit = (message: CreateUnitResponse): void => {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.log('handleServerCreateUnit', message)\n\t\tconst { position: pos, id } = message.CreatUnit\n\t\tthis.gameWorld.addGameObject(this.createMoveableTower(id, pos[0], pos[1]))\n\t}\n\n\tprivate handleServerSetUnit = (message: SetUnitMessage): void => {\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.log('handleServerSetUnit', message)\n\t\tconst { position: pos, id } = message.SetUnit\n\t\tthis.gameWorld.setGameObject(id, 'destination', { x: pos[0], z: pos[1], y: 0.1 })\n\t\tthis.gameWorld.setGameObject(id, 'position', { x: pos[0], z: pos[1], y: 0.1 })\n\t}\n\n\tprivate handleLoadModelsCompleted = (): void => {\n\t\tthis.gameStateDataService.fetchInitialGameState().then((resp) => {\n\t\t\tthis.connectToServer()\n\t\t\tObject.keys(resp).forEach((key) => {\n\t\t\t\tconst unit = resp[key]\n\t\t\t\tif (unit.position.length >= 2) {\n\t\t\t\t\tthis.gameWorld.addGameObject(this.createMoveableTower(unit.id, unit.position[0], unit.position[1]))\n\t\t\t\t}\n\t\t\t})\n\t\t})\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tpublic handleActionbarButtonClicked = (button: string): void => {\n\t\tthis.gameStateDataService.createUnit(10, 10)\n\t}\n\n\tprivate loadModels = (): void => {\n\t\tthis.modelLoader.loadModels(\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\tname: 'tower',\n\t\t\t\t\tpath: '/tower/scene.gltf',\n\t\t\t\t\tonLoaded: (tower) => tower.object.scale.setScalar(0.03)\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'well',\n\t\t\t\t\tpath: '/well/scene.gltf',\n\t\t\t\t\tonLoaded: (well) => well.object.scale.setScalar(0.3)\n\t\t\t\t}\n\t\t\t],\n\t\t\t() => {\n\t\t\t\tthis.handleLoadModelsCompleted()\n\t\t\t}\n\t\t)\n\t}\n\n\tprivate handleGameObjectReachedDestination = (obj: MoveableGameObject): void => {\n\t\tthis.gameStateDataService.setUnit(obj.key, obj.worldData.position.x, obj.worldData.position.z)\n\t}\n\n\tprivate createMoveableTower = (id: string, posX: number, posZ: number): IGameObject => this.createMoveableGameObject('tower', id, posX, posZ)\n\n\tprivate createMoveableWell = (id: string, posX: number, posZ: number): IGameObject => this.createMoveableGameObject('well', id, posX, posZ)\n\n\tprivate createMoveableGameObject = (modelKey: keyof LoadedModels, id: string, posX: number, posZ: number): IGameObject => {\n\t\tconst model = this.modelLoader.loadedModels[modelKey]\n\t\tconst gameObj = new MoveableGameObject(id, Object3DHelper.setShadows(model.object))\n\t\tgameObj.destinationReached = this.handleGameObjectReachedDestination\n\t\tgameObj.worldData.receiveShadow = true\n\t\tgameObj.worldData.castShadow = true\n\t\tgameObj.worldData.position.y = 0.1\n\t\tgameObj.worldData.position.x = posX\n\t\tgameObj.worldData.position.z = posZ\n\t\treturn gameObj\n\t}\n}\n\nexport default Game\n","import React, { PureComponent } from 'react'\n\nexport type withSvgIconProps = React.SVGProps<SVGSVGElement>\n\nconst withSvgIcon = <P extends React.SVGProps<SVGSVGElement>>(WrappedSvgIcon: React.ComponentType<P>, defaultProps?: withSvgIconProps): React.ComponentType<P & withSvgIconProps> =>\n\tclass WithSvgIcon extends PureComponent<P & withSvgIconProps> {\n\t\tprivate defaultPropValues: withSvgIconProps = {\n\t\t\tfill: '#336699',\n\t\t\t...defaultProps\n\t\t}\n\n\t\trender(): JSX.Element {\n\t\t\tconst { props } = this\n\t\t\tconst { ...svgProps } = { ...this.defaultPropValues, ...props, className: `with-svg-icon ${props.className}` }\n\t\t\treturn <WrappedSvgIcon {...svgProps} />\n\t\t}\n\t}\n\nexport default withSvgIcon\n","var _path, _path2, _path3;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgWellIcon(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 280.667 280.667\",\n    xmlSpace: \"preserve\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M52.544 280.667h174.424c12.169 0 22.595-7.706 26.65-18.46H25.892c4.057 10.754 14.482 18.46 26.652 18.46zM24.069 231.035h231.374v19.172H24.069zM25.078 219.035h229.357c-3.298-12.057-14.368-20.985-27.467-20.985H52.544c-13.098 0-24.17 8.929-27.466 20.985zM197.552 0H83.332L6.334 87.92h267.999v-.238zM63.06 94.662v97.54h19.491l.01-54.073H129.745a13.715 13.715 0 0 0 10.187 4.521c4.033 0 7.671-1.744 10.187-4.521h47.33v54.073h19.649v-97.54h-19.671l-.023 26.074h-46.446c-2.504-3.366-6.505-5.552-11.025-5.552-4.521 0-8.522 2.186-11.026 5.552H82.595V94.662H63.06zm76.872 26.244c4.419 0 8.011 3.592 8.011 8.011 0 4.418-3.592 8.01-8.011 8.01-4.42 0-8.012-3.592-8.012-8.01 0-4.419 3.592-8.011 8.012-8.011z\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"m125.269 171.636 4.033 20.612h20.883l3.751-20.612h-11.534v1.271a2.487 2.487 0 0 1-2.483 2.48h-.022a2.487 2.487 0 0 1-2.481-2.48v-1.271h-12.147z\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M139.909 174.73a2.004 2.004 0 0 0 2.005-2.005v-24.262a2.005 2.005 0 1 0-4.011 0v24.262c0 1.107.898 2.005 2.006 2.005z\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgWellIcon);\nexport default __webpack_public_path__ + \"static/media/well-icon.a58b4836.svg\";\nexport { ForwardRef as ReactComponent };","import './index.scss'\nimport withSvgIcon from './withSvgIcon'\nimport { ReactComponent as TowerIconSVG } from '../../../assets/icons/tower-icon.svg'\nimport { ReactComponent as WellIconSVG } from '../../../assets/icons/well-icon.svg'\n\nconst TowerIcon = withSvgIcon(TowerIconSVG)\nconst WellIcon = withSvgIcon(WellIconSVG)\nexport { TowerIcon, WellIcon }\n","import React, { PureComponent } from 'react'\nimport './basicUI.scss'\nimport { TowerIcon, WellIcon } from '../../../components/ui/icons'\n\ninterface BasicUIProps {\n\tonClickButton: (event: MouseEvent, button: string) => void\n}\nclass BasicUI extends PureComponent<BasicUIProps> {\n\thandleButtonClick =\n\t\t(button: string) =>\n\t\t(event: React.MouseEvent<HTMLButtonElement>): void => {\n\t\t\tevent.preventDefault()\n\t\t\tconst { onClickButton } = this.props\n\t\t\tonClickButton(event.nativeEvent, button)\n\t\t}\n\n\trender = (): JSX.Element => {\n\t\treturn (\n\t\t\t<div className=\"ui-actionbar\">\n\t\t\t\t<button type=\"button\" onClick={this.handleButtonClick('tower')}>\n\t\t\t\t\t<TowerIcon />\n\t\t\t\t</button>\n\t\t\t\t<button type=\"button\" onClick={this.handleButtonClick('well')}>\n\t\t\t\t\t<WellIcon />\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default BasicUI\n","import React, { PureComponent } from 'react'\nimport Game from '../../game'\nimport BasicUI from './components/basicUI'\n\nclass GameContainer extends PureComponent<Record<string, never>> {\n\tprivate initialized = false\n\n\tprivate game: Game | undefined\n\n\tprivate gameContainer: HTMLDivElement | null = null\n\n\tcomponentDidMount(): void {\n\t\tthis.initGame()\n\t}\n\n\tinitGame = (): void => {\n\t\tif (this.gameContainer && !this.initialized) {\n\t\t\tthis.game = new Game(this.gameContainer)\n\t\t\tthis.game.initialize()\n\t\t\tthis.initialized = true\n\t\t}\n\t}\n\n\thandleActionbarButtonClicked = (event: MouseEvent, button: string): void => {\n\t\tif (this.game) {\n\t\t\tthis.game.handleActionbarButtonClicked(button)\n\t\t}\n\t}\n\n\trender = (): JSX.Element => {\n\t\treturn (\n\t\t\t<div className=\"game\">\n\t\t\t\t<div\n\t\t\t\t\tid=\"game-container\"\n\t\t\t\t\tref={(gameContainer): void => {\n\t\t\t\t\t\tthis.gameContainer = gameContainer\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t\t<BasicUI onClickButton={this.handleActionbarButtonClicked} />\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default GameContainer\n","import React, { PureComponent } from 'react'\nimport { Link } from 'react-router-dom'\n\nclass HomeContainer extends PureComponent<Record<string, never>> {\n\trender = (): JSX.Element => {\n\t\treturn (\n\t\t\t<div className=\"home\" style={{ padding: 100 }}>\n\t\t\t\t<Link to=\"/game\" style={{ fontSize: 50 }}>\n\t\t\t\t\tGame\n\t\t\t\t</Link>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default HomeContainer\n","import React, { PureComponent } from 'react'\nimport { HashRouter, Route } from 'react-router-dom'\nimport GameContainer from './game/index'\nimport HomeContainer from './home'\n\nclass App extends PureComponent {\n\trender = (): JSX.Element => {\n\t\treturn (\n\t\t\t<div className=\"App\">\n\t\t\t\t<HashRouter basename={process.env.PUBLIC_URL}>\n\t\t\t\t\t<Route path=\"/\" exact>\n\t\t\t\t\t\t<HomeContainer />\n\t\t\t\t\t</Route>\n\t\t\t\t\t<Route path=\"/game\">\n\t\t\t\t\t\t<GameContainer />\n\t\t\t\t\t</Route>\n\t\t\t\t</HashRouter>\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport App from './containers'\nimport './styles/index.scss'\n\n// let logCount = 0\nwindow.log = (message?: unknown, ...optionalParams: unknown[]): void => {\n\t// eslint-disable-next-line no-console\n\tconsole.log(message, optionalParams)\n}\nwindow.logCount = 0\nwindow.logC = (message?: unknown, mod = 100, ...optionalParams: unknown[]): void => {\n\tif (window.logCount === 0 || window.logCount % mod === 1) {\n\t\twindow.log(message, optionalParams)\n\t}\n\twindow.logCount += 1\n}\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n)\n"],"sourceRoot":""}